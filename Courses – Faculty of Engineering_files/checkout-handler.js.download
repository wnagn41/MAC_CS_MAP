jQuery(($) => {
    var paymentForm = $('.gfield:contains("Moneris Checkout")').length > 0;

    if(paymentForm){
        const monerisPriceField = $('.gfield:contains("Moneris Price")').find('.ginput_container input');

        gform.addFilter('gform_product_total', function(total, formId){
            // do something with the total
            monerisPriceField.val(total.toFixed(2));
            localStorage.setItem("gform_checkout_total", total.toFixed(2));
            localStorage.setItem("gform_checkout_form_id", formId);
            return total;
        });
        
        const paymentDepartmentField = $('.gfield:contains("Payment Department")').find('.ginput_container input');
        const paymentDepartmentCodeField = $('.gfield:contains("Payment Department Code")').find('.ginput_container input');
        const orderWeightField = $('.gfield:contains("Order Weight")').find('.ginput_container input');

        localStorage.setItem("gform_payment_department", paymentDepartmentField.val());
        localStorage.setItem("gform_payment_department_code", paymentDepartmentCodeField.val());
        localStorage.setItem("gform_order_weight", orderWeightField.val());

        // Billing Email handling
        const billingEmailField = $('.gfield:contains("Billing Email")');
        if (billingEmailField) {
            const billingEmailInput = $(billingEmailField).find('.ginput_container input');
            
            $(billingEmailInput).on('input', function(){
                // Get the value of the input field
                var billingEmailVal = $(this).val();
                localStorage.setItem("gform_billing_email", billingEmailVal);
            });
        }
    }
});